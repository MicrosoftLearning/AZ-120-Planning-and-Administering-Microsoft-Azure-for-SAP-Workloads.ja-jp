---
lab:
  title: 06b - Azure Center for SAP solutions (ACSS) のデプロイとメンテナンスの概要
  module: Design and implement an infrastructure to support SAP workloads on Azure
---

# AZ 1006 モジュール: Azure で SAP ワークロードをサポートするためのインフラストラクチャを設計して実装する
# AZ-1006 1 日コース ラボ: Azure Center for SAP solutions (ACSS) のデプロイとメンテナンスの概要

予測される所要時間:100 分

AZ-1006 1 日コース ラボのすべてのタスクは Azure portal から実行します

## 目標

このラボを完了すると、次のことができるようになります。

- Azure Center for SAP solutions を使用して、Azure で SAP ワークロードをホストするインフラストラクチャのデプロイとメンテナンスを行う

## 手順

### 演習 1:Azure Center for SAP solutions を使って Azure での SAP ワークロードのデプロイを評価するための最低限の前提条件を実装する

期間: 30 分

この演習では、Azure Center for SAP solutions を使って、Azure での SAP ワークロードのデプロイを評価するための最低限の前提条件を実装します。 これには次のアクティビティが含まれます。

>**重要**: この演習で実装する前提条件は、Azure Center for SAP solutions を使って Azure に SAP ワークロードをデプロイするためのベスト プラクティスを表すことが目的では "ありません"。** その目的は、Azure Center for SAP solutions を使い、デプロイ後の管理およびメンテナンス タスクを実行することで、Azure に SAP ワークロードをデプロイするしくみを評価するために必要な時間、コスト、リソースを最小限に抑えることです。 前提条件の実装には、次のアクティビティが含まれます。

- Azure Storage アクセスのために Azure Center for SAP solutions によってデプロイ時に使用される Microsoft Entra ユーザー割り当てマネージド ID を作成する。
- Azure サブスクリプションと Azure Storage 汎用 v2 アカウントへのデプロイ アクセスの実行に使用される Microsoft Entra ユーザー割り当てマネージド ID を付与する
- デプロイに含まれるすべての Azure 仮想マシンをホストする Azure 仮想ネットワークを作成する。
- デプロイをホストする仮想ネットワークのサブネットからの送信アクセスを制限するために使用される、ネットワーク セキュリティ グループ (NSG) を作成して構成する。
- デプロイに含まれる Azure VM からの送信接続を可能にする NAT ゲートウェイを作成および構成する。

これらのアクティビティは、この演習の以下のタスクに対応します。

- タスク 1:Microsoft Entra ユーザー割り当てマネージド ID を作成する
- タスク 2:Microsoft Entra ID ユーザー割り当てマネージド ID の Azure ロールベースのアクセス制御 (RBAC) ロールの割り当てを構成する
- タスク 3:Azure 仮想ネットワークを作成する
- タスク 4:ネットワーク セキュリティ グループを作成して構成する
- タスク 5:NAT ゲートウェイを作成して構成する

#### タスク 1:Microsoft Entra ユーザー割り当てマネージド ID を作成する

このタスクでは、Azure Storage アクセスのために Azure Center for SAP solutions によってデプロイ時に使用される Microsoft Entra ユーザー割り当てマネージド ID を作成します。

1. ラボ コンピューターから Web ブラウザーを起動し、`https://portal.azure.com` の Azure portal に移動して、このラボで使用する Azure サブスクリプションの所有者のロールを持つ Microsoft アカウントまたは Microsoft Entra ID アカウントを使用して認証します。
1. Azure portal が表示されている Web ブラウザー ウィンドウの **[検索]** テキスト ボックスで、**[マネージド ID]** を検索して選択します。
1. **[マネージド ID]** ページで、 **[+ 作成]** を選択します。
1. **[ユーザー割り当てマネージド ID]** ページの **[基本]** タブで、以下の設定を指定した後、 **[確認と作成]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**新しい**リソース グループ **acss-infra-RG** の名前|
   |リージョン|ACSS のデプロイに使う Azure リージョンの名前|
   |名前|**acss-infra-MI**|

1. **[確認]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するのを待たずに、次のタスクに進んでください。 プロビジョニングにかかるのは、わずか数秒です。

   >**注**:この後のタスクの 1 つでは、Azure Center for SAP solutions を使用した SAP ソフトウェアのインストールに対応するために、SAP インストール メディアをホストするストレージ アカウントへのマネージド ID のアクセスを承認します。

#### タスク 2: デプロイの実行に使用される Microsoft Entra ID ユーザー アカウントに対する Azure ロールベースのアクセス制御 (RBAC) ロール割り当てを構成する

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザー ウィンドウの **[検索]** テキスト ボックスで、**[配信登録]** を検索して選択します。
1. **[サブスクリプション]** ページで、このラボで使用する Azure サブスクリプションを表すエントリを選択します。 
1. Azure サブスクリプションのプロパティが表示されているページで、 **[アクセスの制御 (IAM)]** を選択します。
1. **[アクセスの制御 (IAM)]** ページで、 **[+ 追加]** を選択した後、ドロップダウン メニューで **[ロール割り当ての追加]** を選択します。
1. **[ロールの割り当てを追加]** ページの **[ロール]** タブの **[ジョブ関数ロール]** の一覧で、**[Azure Center for SAP solutions service role] (Azure Center for SAP solutions のサービス ロール)** エントリを検索して選択した後、**[次へ]** を選択します。
1. **[ロールの割り当てを追加]** ページの **[メンバー]** タブで、**[アクセスの割り当て先]** に対して **[Managed Identity] (マネージド ID)** を選択し、**[+ メンバーを選択する]** をクリックします。
1. **[Select managed identities] (マネージド ID の選択)** ウィンドウで、次の設定を指定します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |マネージド ID|**ユーザー割り当てマネージド ID**|
   |選択|**acss-infra-MI**|
1. マネージド ID の一覧で、**[acss-infra-MI]** エントリを選択し、**[選択]** をクリックします。
1. **[メンバー]** タブに戻って、 **[確認と割り当て]** を選択します。  
1. **[確認と割り当て]** タブで、 **[確認と割り当て]** を選択します。
   
   ##### 以下を追加します。"Azure Center for SAP solutions の管理者 ID"
   
1. **[アクセスの制御 (IAM)]** ページに戻り、**[+ 追加]** を選択した後、ドロップダウン メニューで **[ロールの割り当てを追加]** を選択します。
1. **[ロール割り当ての追加]** ページの **[ロール]** タブの **[ジョブ関数ロール]** の一覧で、 **[Azure Center for SAP solutions 管理者]** エントリを検索して選択した後、 **[次へ]** を選択します。
1. ** [メンバー]** タブ
   - (**[アクセスの割り当て先]** の) で、**[ユーザー、グループ、またはサービス プリンシパル]** を選択し、
   - **[+ メンバーを選択する]** をクリックします。
1. **[メンバーの選択]** ペインの **[選択]** テキスト ボックスに、このラボで使用している Azure サブスクリプションへのアクセスに使用した Microsoft Entra ID ユーザー アカウントの名前を入力し、エントリに一致する結果の一覧の中でそれを選択した後、**[選択]** をクリックします。
1. **[メンバー]** タブに戻って、 **[確認と割り当て]** を選択します。
1. **[確認と割り当て]** タブで、 **[確認と割り当て]** を選択します。
   
   ##### 以下を追加します。"マネージド ID オペレーター"
   
1. **[アクセスの制御 (IAM)]** ページに戻り、**[+ 追加]** を選択した後、ドロップダウン メニューで **[ロールの割り当てを追加]** を選択します。
1. **[ロール割り当ての追加]** ページの **[ロール]** タブの **[ジョブ関数ロール]** の一覧で、**[マネージド ID オペレーター]** エントリを検索して選択した後、**[次へ]** を選択します。
1. ** [メンバー]** タブ
   - (**[アクセスの割り当て先]** の) で、**[ユーザー、グループ、またはサービス プリンシパル]** を選択し、
   - **[+ メンバーを選択する]** をクリックします。
1. **[メンバーの選択]** ペインの **[選択]** テキスト ボックスに、このラボで使用している Azure サブスクリプションへのアクセスに使用した Microsoft Entra ID ユーザー アカウントの名前を入力し、エントリに一致する結果の一覧の中でそれを選択した後、**[選択]** をクリックします。
1. **[メンバー]** タブに戻って、 **[確認と割り当て]** を選択します。
1. **[確認と割り当て]** タブで、 **[確認と割り当て]** を選択します。

#### タスク 3:仮想ネットワークを作成する

このタスクでは、デプロイに含まれるすべての Azure 仮想マシンをホストする Azure 仮想ネットワークを作成します。 さらに、仮想ネットワーク内に次のサブネットを作成します。

- app - SAP アプリケーションと SAP セントラル サービス インスタンス サーバーをホストすることを目的としています
- db - SAP データベース層をホストすることを目的としています

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザー ウィンドウの **[検索]** テキスト ボックスで、**[仮想ネットワーク]** を検索して選択します。
1. **[仮想ネットワーク]** ページで、**[+ 作成]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[基本]** タブで、以下の設定を指定し、 **[次へ]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-infra-RG**|
   |仮想ネットワーク名|**acss-infra-VNET**|
   |リージョン|この演習の前のタスクで使用したのと同じ Azure リージョンの名前|

1. **[セキュリティ]** タブで、既定の設定をそのまま使用し、 **[次へ]** を選択します。

   >**注**: この時点で Azure Bastion と Azure Firewall の両方をプロビジョニングできますが、仮想ネットワークが作成されてから、それらを個別にプロビジョニングします。

1. **[IP アドレス]** タブで、以下の設定を指定した後、 **[確認と作成]** を選択します。

   |設定|値|
   |---|---|
   |IP アドレス空間|**10.0.0.0/16 (65,536 個のアドレス)**|

1. サブネットの一覧でごみ箱アイコンを選択して、**既定**のサブネットを削除します。
1. **+ サブネットの追加** を選択します。
1. **[サブネットの追加]** ペインで、以下の設定を指定してから、**[追加]** を選択します (他の設定は既定値のまま)。

   |設定|値|
   |---|---|
   |名前|**app**|
   |開始アドレス|**10.0.2.0**|
   |サイズ|**/24 (256 アドレス)**|

1. **+ サブネットの追加** を選択します。
1. **[サブネットの追加]** ペインで、以下の設定を指定してから、**[追加]** を選択します (他の設定は既定値のまま)。

   |設定|値|
   |---|---|
   |名前|**db**|
   |開始アドレス|**10.0.3.0**|
   |サイズ|**/24 (256 アドレス)**|

1. **[IP アドレス]** タブで、**[確認および作成]** を選択します。
1. **[確認および作成]** タブで、検証プロセスが完了するのを待ってから、**[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するのを待たずに、次のタスクに進んでください。 プロビジョニングにかかるのは、わずか数秒です。

#### タスク 4:ネットワーク セキュリティ グループを作成して構成する

このタスクでは、デプロイをホストする仮想ネットワークのサブネットからの送信アクセスを制限するために使用されるネットワーク セキュリティ グループ (NSG) を作成して構成します。 これを実現するには、インターネットへの接続をブロックしますが、以下のサービスへの接続を明示的に許可します。

- SUSE または Red Hat 更新インフラストラクチャ エンドポイント
- Azure Storage
- Azure Key Vault
- Microsoft Entra ID
- Azure Resource Manager

>**注**:一般に、NSG ではなく Azure Firewall を使用して SAP デプロイのネットワーク接続をセキュリティで保護することを検討する必要があります。 

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザー ウィンドウの **[検索]** テキスト ボックスで、**[ネットワーク セキュリティ グループ]** を検索して選択します。
1. [**ネットワーク セキュリティ グループ**] ページで、 **[+ 作成]** を選択します。
1. **[ネットワーク セキュリティ グループの作成]** ページの **[基本]** タブで、以下の設定を指定した後、 **[確認と作成]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-infra-RG**|
   |名前|**acss-infra-NSG**|
   |リージョン|この演習で前に使用したのと同じ Azure リージョンの名前|

1. **[確認と作成]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するまで待ちます。 プロビジョニングには 1 分かからないはずです。

1. **[デプロイが完了しました]** ページで、**[リソースに移動]** を選択します。

   >**注**: 既定では、ネットワーク セキュリティ グループの組み込みルールは、すべての送信トラフィック、同じ仮想ネットワーク内のすべてのトラフィック、およびピアリングされた仮想ネットワーク間のすべてのトラフィックを許可します。 セキュリティの観点から、この既定の動作を制限することを検討してください。 提示された構成では、インターネットと Azure への送信接続が制限されます。 NSG 規則を使用して、仮想ネットワーク内の接続を制限することもできます。

1. **[acss-infra-NSG]** ページのナビゲーション メニューの **[設定]** セクションで、**[送信セキュリティ規則]** を選択します。
1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   >**注**:Red Hat 更新インフラストラクチャ エンドポイントへの接続を明示的に許可するには、次の規則を追加する必要があります。

   >**注**: RHEL に使用する IP アドレスを特定するには、「[インフラストラクチャ デプロイのためのネットワークの準備](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/prepare-network#allowlist-suse-or-red-hat-endpoints)」を参照してください

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |宛先|**IP アドレス**|
   |宛先 IP アドレス/CIDR 範囲|**13.91.47.76、40.85.190.91、52.187.75.218、52.174.163.213、52.237.203.198、52.136.197.163、20.225.226.182、52.142.4.99、20.248.180.252、20.24.186.80**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**300**|
   |名前|**AllowAnyRHELOutbound**|
   |説明|**RHEL 更新インフラストラクチャ エンドポイントへの送信接続を許可する**|

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   >**注**:SUSE 更新インフラストラクチャ エンドポイントへの接続を明示的に許可するには、次の規則を追加する必要があります。

   >**注**: SUSE に使用する IP アドレスを識別するには、「[インフラストラクチャ デプロイのためのネットワークの準備](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/prepare-network#allowlist-suse-or-red-hat-endpoints)」を参照してください

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |宛先|**IP アドレス**|
   |宛先 IP アドレス/CIDR 範囲|**52.188.224.179、52.186.168.210、52.188.81.163、40.121.202.140**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**305**|
   |名前|**AllowAnySUSEOutbound**|
   |説明|**SUSE 更新インフラストラクチャ エンドポイントへの送信接続を許可する**|

   >**注**:Azure Storage への接続を明示的に許可するには、次の規則を追加する必要があります。

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |到着地|**サービス タグ**|
   |宛先サービス タグ|**Storage**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**400**|
   |名前|**AllowAnyCustomStorageOutbound**|
   |説明|**Azure Storage への送信接続を許可する**|

   >**注**:**Storage** サービス タグは、**Storage.EastUS** などのリージョン固有のものに置き換えることができます。

   >**注**:Azure Key Vault への接続を明示的に許可するには、次の規則を追加する必要があります。

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |到着地|**サービス タグ**|
   |宛先サービス タグ|**AzureKeyVault**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**500**|
   |名前|**AllowAnyCustomKeyVaultOutbound**|
   |説明|**Azure Key Vault への送信接続を許可する**|

   >**注**:Microsoft Entra ID への接続を明示的に許可するには、次の規則を追加する必要があります。

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |到着地|**サービス タグ**|
   |宛先サービス タグ|**AzureActiveDirectory**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**600**|
   |名前|**AllowAnyCustomEntraIDOutbound**|
   |説明|**Microsoft Entra ID への送信接続を許可する**|

   >**注**:Azure Resource Manager への接続を明示的に許可するには、次の規則を追加する必要があります。

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |到着地|**サービス タグ**|
   |宛先サービス タグ|**AzureResourceManager**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**許可**|
   |Priority|**700**|
   |名前|**AllowAnyCustomARMOutbound**|
   |説明|**Azure Resource Manager への送信接続を許可する**|

   >**注**:インターネットへの接続を明示的にブロックするには、最後の規則を追加する必要があります。

1. **[acss-infra-NSG \| 送信セキュリティ規則]** ページで、**[+ 追加]** を選択します。
1. **[送信セキュリティ規則の追加]** ペインで、以下の設定を指定し、**[追加]** を選択します。

   |設定|値|
   |---|---|
   |source|**[任意]**|
   |ソース ポート範囲|*|
   |到着地|**サービス タグ**|
   |宛先サービス タグ|**Internet**|
   |サービス|**カスタム**|
   |宛先ポート範囲|*|
   |プロトコル|**[任意]**|
   |アクション|**Deny**|
   |Priority|**1000**|
   |名前|**DenyAnyCustomInternetOutbound**|
   |説明|**インターネットへの送信接続を拒否する**|

   >**注**:最後に、SAP デプロイをホストする仮想ネットワークの関連サブネットに NSG を割り当てる必要があります。

1. **[送信セキュリティ規則の追加]** ペインのナビゲーション メニューの **[設定]** セクションで、**[サブネット]** を選択します。
1. **[acss-infra-NSG \| サブネット]** ページで、**[+ 関連付け]** を選択します。
1. **[サブネットの関連付け]** ペインの **[仮想ネットワーク]** ドロップダウン リストで、**[acss-intra-VNET (acss-infra-RG)]** を選択し、**[サブネット]** ドロップダウン リストで **[app]** を選択して、**[OK]** を選択します。
1. **[サブネットの関連付け]** ペインの **[仮想ネットワーク]** ドロップダウン リストで、**[acss-intra-VNET (acss-infra-RG)]** を選択し、**[サブネット]** ドロップダウン リストで **[db]** を選択した後、**[OK]** を選択します。

#### タスク 5:NAT ゲートウェイを作成して構成する

このタスクでは、デプロイに含まれる Azure VM が SUSE や RHEL エンドポイントなどの外部サービスに到達できるようにする、ネットワーク アドレス変換 (NAT) ゲートウェイを作成して構成します。

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザー ウィンドウの **[検索]** テキスト ボックスで、**[NAT Gateways] (NAT ゲートウェイ)** を検索して選択します。
1. **[NAT gateways] (NAT ゲートウェイ)** ページで、**[+ 作成]** を選択します。
1. **[ネットワーク アドレス変換 (NAT) ゲートウェイを作成します]** ページの **[基本]** タブで、以下の設定を指定した後、**[次へ:送信 IP] >** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-infra-RG**|
   |NAT ゲートウェイ名|**acss-infra-NATGW**|
   |リージョン|この演習で前に使用したのと同じ Azure リージョンの名前|
   |可用性ゾーン|**No Zone (ゾーンなし)**|
   |TCP アイドル タイムアウト (分)|**4**|

1. **[送信 IP]** タブの **[パブリック IP アドレス]** ドロップダウン リストの下にある **[新しいパブリック IP アドレスの作成]** リンクを選択し、**[パブリック IP アドレスの追加]** ウィンドウの **[名前]** テキスト ボックスに 「**acss-infra-NATWG-PIP**」と入力し、**[OK]** を選択します。
1. **[送信 IP]** タブに戻り、**[次へ:サブネット] >** を選択します。
1. **[サブネット]** タブの **[Virtual Network]** ドロップダウン リストで **[acss-infra-VNET]** を選択し、サブネットの一覧で、**app** および **db** エントリの横にあるチェック ボックスをオンにし、**[確認 + 作成]** を選択します。
1. **[確認と作成]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するまで待ちます。 プロビジョニングには 1 分ほどかかるはずです。

### 演習 2:Azure Center for SAP solutions を使用して、Azure で SAP ワークロードをホストするインフラストラクチャをデプロイする

期間:40 分

この演習では、Azure Center for SAP solutions のデプロイを実行します。 これには次のアクティビティが含まれます。

- Azure Center for SAP solutions を使用して、SAP ワークロードをホストできるインフラストラクチャを Azure サブスクリプションにデプロイします。

このアクティビティは、この演習の以下のタスクに対応します。

- タスク 1:Virtual Instance for SAP (VIS) solutions を作成する

>**注**:デプロイが成功したら、Azure Center for SAP solutions を使用した SAP ソフトウェアのインストールに進むことができます。 ただし、このラボには SAP ソフトウェアのインストールは含まれていません。

>**注**:Azure Center for SAP solutions を使用した SAP ソフトウェアのインストールの詳細については、Microsoft Learn のドキュメントを参照してください。このドキュメントでは、[SAP インストール メディアを取得](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/get-sap-installation-media)し、[SAP ソフトウェアをインストール](https://learn.microsoft.com/en-us/azure/sap/center-sap-solutions/install-software)する方法について説明しています。 

#### タスク 1:Virtual Instance for SAP (VIS) solutions を作成する

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、 **[Azure Center for SAP solutions]** を検索して選択します。 
1. **[Azure Center for SAP solutions \| 概要]** ページで、 **[新しい SAP システムの作成]** を選択します。
1. **[Virtual Instance for SAP solutions の作成]** ページの **[基本]** タブで、以下の設定を指定し、 **[次へ : 仮想マシン]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**新しい**リソース グループ **acss-vi-RG** の名前|
   |名前 (SID)|**VI1**|
   |リージョン|ACSS に登録された SAP デプロイまたは同じ地域の別のリージョンをホストしている Azure リージョンの名前|
   |環境の種類|**非実稼働**|
   |SAP 製品|**S/4HANA**|
   |データベース|**HANA**|
   |HANA スケーリング方法|**スケールアップ (推奨)**|
   |デプロイの種類|**高可用性 (HA) を備えた分散**|
   |コンピューティングの可用性|**99.95 (可用性セット)**|
   |仮想ネットワーク|**acss-infra-VNET**|
   |アプリケーション サブネット|**app (10.0.2.0/24)**|
   |データベース サブネット|**db (10.0.3.0/24)**|
   |アプリケーション OS イメージのオプション|**Marketplace イメージを使用する**|
   |アプリケーション OS イメージ|**Red Hat Enterprise Linux 8.2 for SAP Applications - x64 Gen2 最新版**|
   |データベース OS イメージのオプション|**Marketplace イメージを使用する**|
   |データベース OS イメージ|**Red Hat Enterprise Linux 8.2 for SAP Applications - x64 Gen2 最新版**|
   |SAP トランスポート オプション|**新しい SAP トランスポート ディレクトリを作成する**|
   |トランスポート リソース グループ|**acss-infra-RG**|
   |ストレージ アカウント名|エントリなし|
   |認証の種類|**SSH パブリック**|
   |ユーザー名|**contososapadmin**|
   |SSH 公開キーのソース|**新しいキーの組の生成**|
   |キーの組名|**contosovi1key**|
   |SQP FQDN|**sap.contoso.com**|
   |マネージド ID ソース|**既存のユーザー割り当てマネージド ID を使用する**|
   |マネージド ID 名|**acss-infra-MI**|

1. **[仮想マシン]** タブで、以下の設定を指定します。

   |設定|値|
   |---|---|
   |以下に基づいて推奨事項を生成する|**SAP Application Performance Standard (SAPS) - アプリケーション層とデータベース メモリ サイズの SAPS を提供するにはこのオプションを選択し、[推奨事項の生成] をクリックします**|
   |アプリケーション層の SAPS|**1000**|
   |データベースのメモリ サイズ (GiB)|**128**|

1. **[レコメンデーションの生成]** を選択します。
1. ASCS、アプリケーション、およびデータベース仮想マシンの VM のサイズと数を確認します。

   >**注**: 必要に応じて、仮想マシンの各セットの **[すべてのサイズを表示]** リンクを選択して代替サイズを選択することで、推奨サイズを調整します。 既定では、上で指定したアプリケーション層 SAPS とデータベース メモリ サイズに加え、高可用性を備える分散デプロイ タイプの最小 VM SKU に関する推奨事項は以下のようになります。
   - ASCS VM 用の 2 個の Standard_D4ds_v5 (それぞれ 4 個の vCPU と 16 GiB のメモリ)
   - アプリケーション VM 用の 2 個の Standard_D4ds_v5 VM (それぞれ 4 個の vCPU と 16 GiB のメモリ)
   - データベース VM 用の 2 個の Standard_E16ds_v5 (それぞれ 16 個の vCPU と 128 GiB のメモリ)

   >**注**: 必要に応じて、仮想マシンの特定の SKU の **[クォータの要求]** リンクを選択してクォータの引き上げ要求を送信することで、クォータの引き上げを要求できます。 通常、要求の処理には数分かかります。

   >**注**: Azure Center for SAP solutions では、デプロイ時に SAP でサポートされている VM SKU の使用が強制されます。

1. **[仮想マシン]** タブの **[データ ディスク]** セクションで、 **[構成の表示とカスタマイズ]** リンクを選択します。
1. **[データベース ディスクの構成]** ページで、変更を加えずに推奨構成を確認し、 **[閉じる]** を選択します。
1. **[仮想マシン]** タブに戻り、 **[次へ : アーキテクチャの視覚化]** を選択します。
1. **[アーキテクチャの視覚化]** タブで、推奨アーキテクチャを示す図を確認し、 **[確認と作成]** を選択します。
1. **[確認と作成]** タブで、検証プロセスが完了するまで待ち、"クォータ不足" エラーが発生しないようにデプロイ リージョン内に利用可能なクォータが十分あることを確認するチェックボックスを選択し、 **[作成]** を選択します。
1. 求められたら、 **[新しいキーの組の生成]** ウィンドウで、 **[秘密キーのダウンロードとリソースの作成]** を選択します。

   >**注**: デプロイに含まれる Azure VM への接続に必要な秘密キーは、このラボを実行しているコンピューターにダウンロードされます。

   >**注**: デプロイが完了するまで待ちます。 これには 25 分ほどかかる場合があります。

   >**注**:デプロイ後、Azure Center for SAP solutions を使用した SAP ソフトウェアのインストールに進むことができます。 このラボでは、SAP ソフトウェアをインストールせずに、Azure Center for SAP solutions の機能を確認します。

### 演習 3:Azure Center for SAP solutions を使用して Azure で SAP ワークロードを維持する

期間:60 分

この演習では、Azure Center for SAP solutions を使用して、デプロイ後の管理と SAP ワークロードの監視について確認します。 これには次のアクティビティが含まれます。

- Azure Center for SAP solutions によって管理される SAP ワークロードのバックアップの前提条件を実装する 
- Azure Center for SAP solutions によって管理される SAP ワークロードのディザスター リカバリーの前提条件を実装する 
- Azure Center for SAP solutions によって管理される SAP ワークロードで使用できる監視オプションを確認する 
- このラボでプロビジョニングした Azure リソースをすべて削除する。

これらのアクティビティは、この演習の以下のタスクに対応します。

- タスク 1:Azure Center for SAP solutions によって管理される SAP ワークロードのバックアップの前提条件を実装する 
- タスク 2:Azure Center for SAP solutions によって管理される SAP ワークロードのディザスター リカバリーの前提条件を実装する 
- タスク 3:Azure Center for SAP solutions によって管理される SAP ワークロードの監視オプションを確認する 
- タスク 4:ラボでプロビジョニングした Azure リソースを削除する

#### タスク 1:Azure Center for SAP solutions によって管理される SAP ワークロードのバックアップの前提条件を実装する

>**注**:Azure Center for SAP solutions の VIS リソース レベルで Azure Backup を構成すると、データベース、アプリケーション サーバー、SAP セントラル サービス インスタンスをホストする Azure VM と HANA DB のバックアップを 1 つの手順で有効にすることができます。 HANA DB バックアップについては、Azure Center for SAP solutions でバックアップの事前登録スクリプトが自動的に実行されます。

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、 **[Azure Center for SAP solutions]** を検索して選択します。
1. **[Azure Center for SAP Solutions \| 概要]** ページの左側にある縦型ナビゲーション メニューで、**[Virtual Instance for SAP solutions]** を選択し、仮想インスタンスの一覧で、前の演習でデプロイしたインスタンスを選択します。
1. 仮想インスタンス ページの左側にある縦型ナビゲーション メニューの **[操作]** セクションで、**[バックアップ (プレビュー)]** を選択します。
1. この SAP システムの SAP ソフトウェアのインストールまたは登録が完了していないためにバックアップをセットアップできないことを示すメッセージに注意してください。

   >**注**:これは予測されていることです。 SAP ソフトウェアのインストールが完了するまで、この方法でバックアップを設定することはできません。 ただし、セットアップを完了するには、コンテナーとバックアップ ポリシーの作成など、追加の前提条件も必要です。それについて、ここで確認します。 

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、**[バックアップ センター]** を検索して選択します。 
1. **[バックアップ センター]** ページの左側にある縦型ナビゲーション メニューの **[管理]** セクションで、**[コンテナー]** を選択します。
1. **[バックアップ センター \| コンテナー]** ページで、**[+ コンテナー]** を選択します。
1. **[開始: コンテナーの作成]** ページで、使用可能なコンテナーの種類を確認し、**Recovery Services コンテナー** (**Azure 仮想マシン**と **Azure VM の SAP HANA** のデータソースの種類をサポート) が選択されていることを確認してから、**[続行]** を選択します。
1. **[Recovery Services コンテナーの作成]** ページの **[基本]** タブで、以下の設定を指定し、**[次へ: 冗長性]** を選択します

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**新しい**リソース グループ **acss-mgmt-RG** の名前|
   |Vault 名|**acss-backup-RSV**|
   |リージョン|ACSS に登録された SAP デプロイをホストしている Azure リージョンの名前|

1. **[冗長性]** タブで、以下の設定を指定し、**[次へ: コンテナーのプロパティ]** を選択します

   |設定|Value|
   |---|---|
   |バックアップ ストレージの冗長性|**geo 冗長**|
   |リージョンをまたがる復元|**有効にする**|

1. **[コンテナーのプロパティ]** タブで、**不変性を有効にする**設定を有効にせずに確認し、**[次へ: ネットワーク]** をクリックします
1. **[ネットワーク]** タブで、既定のオプションの **[すべてのネットワークからのパブリック アクセスを許可する]** をそのまま使い、**[確認および作成]** を選びます
1. **[確認と作成]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するまで待ちます。 プロビジョニングには 2 分ほどかかる場合があります。

1. **[デプロイが完了しました]** ページで、**[リソースに移動]** を選択します。
1. **[acss-backup-RSV]** ページの左側にある縦型ナビゲーション メニューの **[管理]** セクションで、**[バックアップ ポリシー]** を選択します。
1. **[acss-backup-RSV \| バックアップ ポリシー]** ページで、**[+ 追加]** を選択します。
1. **[ポリシーの種類の選択]** ページで、使用可能なポリシーの種類を確認します。

   >**注**:まず、データベース、アプリケーション サーバー、SAP セントラル サービス インスタンスをホストする Azure VM のバックアップ ポリシーを構成します。

1. **[ポリシーの種類の選択]** ページで、**[Azure 仮想マシン]** を選択します。
1. **[ポリシーの作成]** ページで、**[Standard]** と **[Enhanced]** のポリシー サブタイプの違いを確認し、**[Enhanced]** を選択します。

   >**注**:回復性のニーズに基づいて選択する必要があります。 同様に、ニーズに応じて、以下に示す値を調整する必要があります。

1. **[ポリシー名]** テキスト ボックスに、「**acss-vm-enhanced-backup-policy**」と入力します。
1. バックアップ スケジュールの頻度を **[毎時間]**、開始時刻を**午後 6 時**、スケジュールを **[6 時間ごと]**、期間を **[12 時間]**、タイムゾーンをローカル タイム ゾーンに設定します。
1. **[インスタント回復スナップショットの保有期間]** の値を **5** 日間に設定します。
1. **[毎日のバックアップ ポイントの保有期間]** を **60** 日に設定します。
1. 毎週、毎月、毎年のバックアップ ポイントの保有期間を必要に応じて設定します。

   >**注**:階層化を有効にするには、毎月または毎年のバックアップ ポイントを有効にする必要があります。

   >**注**:また、Azure Backup によって自動生成されるリソース グループの名前付け規則を指定することもできます。

1. **［作成］** を選択します
1. **[デプロイが完了しました]** ページで、**[リソースに移動]** を選択します。
1. **[acss-backup-RSV]** ページの左側にある縦型ナビゲーション メニューの **[管理]** セクションで、**[バックアップ ポリシー]** を選択します。
1. **[acss-backup-RSV \| バックアップ ポリシー]** ページで、**[+ 追加]** を選択します。

   >**注**:次に、HANA DB のバックアップ ポリシーを構成します。 ここに示す構成は、MS Learn の記事「[Azure VM 上の SAP HANA データベース インスタンスのスナップショットをバックアップする](https://learn.microsoft.com/en-us/azure/backup/sap-hana-database-instances-backup)」で説明されているガイダンスに従っています。

1. **[ポリシーの種類の選択]** ページで、**[Azure VM 内の SAP HANA (Backint を使用したデータベース)]** を選択します
1. **[ポリシーの作成]** ページの **[ポリシー名]** テキスト ボックスに、「**acss-hanadb-backint-backup-policy**」と入力します。
1. 完全バックアップとログ バックアップの既定の設定をそのまま使用します。 差分バックアップと増分バックアップは無効のままにします。

   >**注**:HANA バックアップ圧縮を有効にして、対象の回復ポイントをコンテナー アーカイブに移動するオプションがあります。 

1. **［作成］** を選択します

1. **[デプロイが完了しました]** ページで、**[リソースに移動]** を選択します。
1. **[acss-backup-RSV]** ページの左側にある縦型ナビゲーション メニューの **[管理]** セクションで、**[バックアップ ポリシー]** を選択します。
1. **[acss-backup-RSV \| バックアップ ポリシー]** ページで、**[+ 追加]** を選択します。
1. **[ポリシーの種類の選択]** ページで、**[Azure VM 内の SAP HANA (スナップショットを使用した DB インスタンス)]** を選択します
1. **[ポリシー の作成]** ページの **[ポリシー名]** テキスト ボックスに、「**acss-hanadb-snapshot-backup-policy**」と入力します。
1. スナップショット バックアップの頻度を、現在のタイム ゾーンの午後 1 時 30 分に設定します。
1. インスタント回復スナップショットを **5** 日間保持するように構成します。
1. スナップショット リソース グループの既定の選択をそのまま使用します。これは **acss-mgmt-RG** に設定されています。
1. **[マネージド ID]** セクションで、**[マネージド ID の作成]** を選択します。 これで、Web ブラウザー ウィンドウに別のタブが自動的に開き、Azure portal の **[Managed Identity] (マネージド ID)** ページが表示されます。
1. **[Managed Identity] (マネージド ID)** ページで、**[+ 作成]** を選択します。
1. **[ユーザー割り当てマネージド ID]** ページの **[基本]** タブで、以下の設定を指定した後、 **[確認と作成]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-mgmt-RG**|
   |リージョン|ACSS デプロイをホストしている Azure リージョンの名前|
   |名前|**acss-mgmt-MI**|

1. **[確認]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するまで待ちます。 プロビジョニングにかかるのは、わずか数秒です。

1. 現在のブラウザー タブを閉じて、**[ポリシーの作成]** ページが表示されているタブに戻ります。
1. **[マネージド ID]** セクションの **[リソース グループ]** ドロップダウン リストで **[acss-mgmt-RG]** を選択し、**[マネージド ID]** ドロップダウン リストで **[acss-mgmt-MI]** を選択します。
1. **［作成］** を選択します

   >**注**:Azure Center for SAP solutions のインターフェイスで VIS レベルのバックアップを構成する場合は、既存のコンテナーとそのポリシーを利用できます。

   >**注**:VIS レベルでバックアップを構成したら、Azure portal の VIS インターフェイスから Azure VM と HANA DB のバックアップ ジョブの状態を監視できます。

#### タスク 2:Azure Center for SAP solutions によって管理される SAP ワークロードのディザスター リカバリーの前提条件を実装する 

>**注**:Azure Center for SAP solutions サービスはゾーン冗長サービスですが、リージョンが停止した場合に Microsoft によって開始されるフェールオーバーはありません。 このようなシナリオを修復するには、「[SAP ワークロードのディザスター リカバリーの概要とインフラストラクチャのガイドライン](https://learn.microsoft.com/en-us/azure/sap/workloads/disaster-recovery-overview-guide)」で説明されている Azure Site Recovery (ASR) の使用を含むガイダンスに従って、Azure Center for SAP solutions を使用してデプロイした SAP システムのディザスター リカバリーを構成する必要があります。 このタスクでは、そのガイダンスを使用した ASR ベースのディザスター リカバリー ソリューションの実装プロセスを順を追って説明します。

>**注**:ASR は、アプリケーション サーバーと SAP セントラル サービス インスタンス用に推奨されるソリューションです。 データベース サーバー用には、それらのネイティブ レプリケーション機能の使用を検討してください。

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、**[Recovery Services コンテナー]** を検索して選択します。
1. **[Recovery Services コンテナー]** ページで、**[+ 作成]** を選択します。
1. **[Recovery Services コンテナーの作成]** ページの **[基本]** タブで、以下の設定を指定し (他の設定は既定値のままにして)、**[次へ: 冗長性]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**新しい**リソース グループ **acss-dr-RG** の名前|
   |Vault 名|**acss-dr-RSV**|
   |リージョン|ACSS 登録済み SAP デプロイとペアになっている Azure リージョンの名前|

   >**注**:運用ワークロードをホストしているリージョンとペアになっているリージョンを特定するには、[Azure のペアになっているリージョン](https://learn.microsoft.com/en-us/azure/reliability/cross-region-replication-azure#azure-paired-regions)について説明している MS Learn ドキュメントを参照してください。

1. **[冗長性]** タブで、以下の設定を指定し、**[次へ: コンテナーのプロパティ]** を選択します

   |設定|Value|
   |---|---|
   |バックアップ ストレージの冗長性|**ローカル冗長**|

1. **[コンテナーのプロパティ]** タブで、**不変性を有効にする**設定を有効にせずに確認し、**[次へ: ネットワーク]** をクリックします
1. **[ネットワーク]** タブで、既定のオプションの **[すべてのネットワークからのパブリック アクセスを許可する]** をそのまま使い、**[確認および作成]** を選びます
1. **[確認と作成]** タブで、検証プロセスが完了するのを待って、 **[作成]** を選択します。

   >**注**:プロビジョニング プロセスが完了するのを待たずに、次のステップに進んでください。 プロビジョニングには 2 分ほどかかる場合があります。

   >**注**:ここで、Recovery Services コンテナーを作成したペアになっているリージョンに、ディザスター リカバリー環境を設定します。 この環境には、Azure VM (Virtual Instance for SAP をプロビジョニングしたプライマリ リージョンで現在ホストされている) のレプリカをホストする仮想ネットワークが含まれます。 

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、**[Recovery Services コンテナー]** を検索して選択します。
1. **[Recovery Services コンテナー] **ページで、**[acss-dr-RSV]** を選択します。
1. **[acss-dr-RSV]** ページの左側にある縦型メニューの **[作業の開始]** セクションで、**[Site Recovery]** を選択します。
1. **[acss-dr-RSV \| Site Recovery]** ページの **[Azure 仮想マシン]** セクションで、次を選択します: **1. レプリケーションを有効にする**。 
1. **[レプリケーションの有効化]** ページの **[ソース]** タブで、以下の設定を指定し、**[次へ]** を選択します。

   |設定|Value|
   |---|---|
   |リージョン|Virtual Instance for SAP (VIS) をホストしている Azure リージョンの名前|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-vi-RG**|
   |仮想マシン デプロイ モデル|**Resource Manager**|
   |可用性ゾーン間でのディザスター リカバリー|**いいえ**|

   >**注**:**可用性ゾーン間のディザスター リカバリー**は、ソース リージョンで可用性ゾーンをサポートされているかどうかによって、構成できない場合があります。

1. **[仮想マシン]** タブで、一覧から最初の 4 台の仮想マシン (**vi1appvm0**、**vi1appvm1**、**vi1ascsvm0**、**vi1ascsvm0**) を選択し、**[次へ]** を選択します。

   >**注**:前述のように、ASR ベースのレプリケーションは、アプリケーション サーバーと SAP セントラル サービス インスタンスに適用されます。 データベース サーバーは、ネイティブのデータベース レプリケーション機能を使用することで、同期された状態に維持されます。

1. **[レプリケーション設定]** タブで、以下の操作を実行します。

   1. 必要に応じて、**[ターゲットの場所]** ドロップダウン リストで、**acss-dr-RSV** Recovery Services コンテナーを作成した Azure リージョンを選択します。
   1. このラボで使われている Azure サブスクリプションの名前が **[ターゲット サブスクリプション]** ドロップダウン リストに表示されていることを確認します。
   1. **[ターゲット リソース グループ]** ドロップダウン リストで、**[acss-dr-RG]** を選択します。
   1. **[フェールオーバー仮想ネットワーク]** ドロップダウン リストで、**[新規作成]** を選びます。
   1. **[仮想ネットワークの作成]** ペインの **[名前]** テキスト ボックスに「**CONTOSO-VNET-asr**」と入力します
   1. **[アドレス空間]** セクションの **[アドレス範囲]** テキスト ボックスで、既定のエントリを「**10.10.0.0/16**」に置き換えます。
   1. **[サブネット]** セクションの **[サブネット名]** テキスト ボックスに「**app**」と入力し、**[アドレスの範囲]** テキスト ボックスに「**10.10.0.0/24**」と入力します。
   1. 新しく追加したサブネット エントリの下の **[サブネット]** セクションにある **[サブネット名]** テキスト ボックスに「**db**」と入力し、**[アドレスの範囲]** テキスト ボックスに、「**10.10.2.0/24**」と入力します。
   1. **[仮想ネットワークの作成]** ペインで **[OK]** を選びます。
   1. **[レプリケーションを有効にする]** ページに戻り、**[フェールオーバー サブネット]** ドロップダウン リストに "**(新規) app (10.10.0.0/24)**" エントリが表示されることを確認します。
   1. **[ストレージ]** セクションで、**[ストレージ構成の表示/編集]** リンクを選択します。
   1. **[ターゲットの設定のカスタマイズ]** ページで構成結果を確認しますが、変更は行わず、**[キャンセル]** を選びます。
   1. **[可用性オプション]** セクションで、**[可用性オプションの表示/編集]** リンクを選択します。
   1. **[可用性オプション]** ページでは、ターゲット リソースに近接配置グループを実装するオプションがありますが、変更は行わず、**[キャンセル]** を選びます。

   >**注**:容量予約を構成するオプションもあります。

   >**重要**: IP アドレス空間は、プライマリおよびセカンダリ リージョンの仮想ネットワーク間で異なることに注意してください。 これは意図的なもので、これによって、2 つのリージョンでホストされているデータベース サーバー間のレプリケーションを構成するために必要な 2 つの仮想ネットワークを相互に接続できるようになります。 このような接続は、仮想ネットワーク ピアリングを使用して確立できます。

1. **[レプリケーションの有効化]** ページの **[レプリケーション設定]** タブに戻り、**[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[管理]** タブで、以下の操作を実行します。

   1. **[レプリケーション ポリシー]** ドロップダウン リストの下にある **[新規作成]** を選択します。
   1. **[レプリケーション ポリシーの作成]** ペインの **[名前]** テキスト ボックスに「**2-day-retention-policy**」と入力し、**[保持期間 (日数)]** テキスト ボックスに「**2**」と入力して、**[OK]** を選択します。
   1. レプリケーション グループを作成するオプションがあります。 このオプションは、このユース ケースには適用されません。
   1. **[拡張機能の設定]** の **[更新の設定]** オプションは、**ASR に管理を許可**するように構成したままにします。
   1. 自動的に割り当てられた既定の **Automation アカウント**の名前をそのまま使用します。

1. **[レプリケーションの有効化]** ページの **[管理]** タブで、**[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[確認]** タブで、**[レプリケーションの有効化]** を選択します。

   >**注**:次に、データベース サーバーをホストしている残りの 2 台の Azure VM のレプリケーションを有効にする手順を実行します。

1. **[acss-dr-RSV \| Site Recovery]** ページに戻り、**[Azure 仮想マシン]** セクションで、次を選択します: **1. レプリケーションを有効にする**。 
1. **[レプリケーションの有効化]** ページの **[ソース]** タブで、以下の設定を指定し、**[次へ]** を選択します。

   |設定|Value|
   |---|---|
   |リージョン|Virtual Instance for SAP (VIS) をホストしている Azure リージョンの名前|
   |サブスクリプション|このラボで使う Azure サブスクリプションの名前|
   |リソース グループ|**acss-vi-RG**|
   |仮想マシン デプロイ モデル|**Resource Manager**|
   |可用性ゾーン間でのディザスター リカバリー|**いいえ**|

   >**注**:**可用性ゾーン間のディザスター リカバリー**は、ソース リージョンで可用性ゾーンをサポートされているかどうかによって、構成できない場合があります。

1. **[仮想マシン]** タブで、一覧から最初の 4 台の仮想マシン (**vi1appvm0**、**vi1appvm1**、**vi1ascsvm0**、**vi1ascsvm0**) を選択し、**[次へ]** を選択します。

   >**注**:残りの 2 台の Azure VM は別のサブネットに接続されているため、別個にレプリケーションを構成する必要があります。

1. **[レプリケーション設定]** タブで、以下の操作を実行します。

   1. 必要に応じて、**[ターゲットの場所]** ドロップダウン リストで、**acss-dr-RSV** Recovery Services コンテナーを作成した Azure リージョンを選択します。
   1. このラボで使われている Azure サブスクリプションの名前が **[ターゲット サブスクリプション]** ドロップダウン リストに表示されていることを確認します。
   1. **[ターゲット リソース グループ]** ドロップダウン リストで、**[acss-dr-RG]** を選択します。
   1. **[フェールオーバー仮想ネットワーク]** ドロップダウン リストで、**[CONTOSO-VNET]** を選択します。
   1. **[フェールオーバー サブネット]** ドロップダウン リストで、**[app (10.10.0.0/24)]** を選択します。
   1. **[ストレージ]** セクションで、**[ストレージ構成の表示/編集]** リンクを選択します。
   1. **[ターゲットの設定のカスタマイズ]** ページで構成結果を確認しますが、変更は行わず、**[キャンセル]** を選びます。
   1. **[可用性オプション]** セクションで、**[可用性オプションの表示/編集]** リンクを選択します。
   1. **[可用性オプション]** ページでは、ターゲット リソースに近接配置グループを実装するオプションがありますが、変更は行わず、**[キャンセル]** を選びます。

   >**注**:容量予約を構成するオプションもあります。

1. **[レプリケーションの有効化]** ページの **[レプリケーション設定]** タブに戻り、**[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[管理]** タブで、以下の操作を実行します。

   1. **[レプリケーション ポリシー]** ドロップダウン リストの下にある **[新規作成]** を選択します。
   1. **[レプリケーション ポリシーの作成]** ペインの **[名前]** テキスト ボックスに「**2-day-retention-policy**」と入力し、**[保持期間 (日数)]** テキスト ボックスに「**2**」と入力して、**[OK]** を選択します。
   1. レプリケーション グループを作成するオプションがあります。 このオプションは、このユース ケースには適用されません。
   1. **[拡張機能の設定]** の **[更新の設定]** オプションは、**ASR に管理を許可**するように構成したままにします。
   1. 自動的に割り当てられた既定の **Automation アカウント**の名前をそのまま使用します。

1. **[レプリケーションの有効化]** ページの **[管理]** タブで、**[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[確認]** タブで、**[レプリケーションの有効化]** を選択します。

   >**注**:初期レプリケーションの完了にはかなり時間がかかる場合があります。 このラボの割り当て時間は限られていることを考慮し、このタスクの一部として実行する追加の手順については、講師に問い合わせてください。 具体的なガイダンスがない場合は、そのまま次のタスクに進んでください。

   >**注**:この時点で Azure Bastion と Azure Firewall の両方をプロビジョニングすることもできますが、そうするのではなくディザスター リカバリー フェールオーバー手順の一部としてプロビジョニングを自動化しましょう。 これにより、ディザスター リカバリー環境の維持に関連する料金が最小限に抑えられます。 その環境で、プライマリ Virtual Instance for SAP の Azure Premium ファイル共有やカスタム ルーティングなどの構成を反映する他のコンポーネントにも、同じことが当てはまります。

#### タスク 3:Azure Center for SAP solutions によって管理される SAP ワークロードの監視オプションを確認する

>**注**:バックアップと同様に、Azure Center for SAP solutions の監視機能を完全に体験することはできません。 そのためには、SAP ソフトウェアのインストールまたは既存の Azure Monitor for SAP solutions インスタンスの登録が必要です。 代わりに、このタスクでは、Virtual Instance for SAP solutions で使用できるインターフェイスを順に見ていきながら、これらの機能を特定して確認します。

1. ラボ コンピューターの Azure portal が表示されている Microsoft Edge ウィンドウの **[検索]** テキスト ボックスで、**[Virtual Instances for SAP solutions]** を検索して選択します。 
1. **[Virtual Instances for SAP solutions]** ページで、全体的な正常性と状態のビジュアル インジケーターを含めて、**VI1** インスタンスの状態の概要情報を確認します。
1. **[Virtual Instances for SAP solutions]** ページで、**[VI1]** を選択します。
1. **[VI1]** ページの左側にある縦型ナビゲーション メニューで **[概要]** を選択し、右側のペインで **[監視]** を選択します。
1. 監視ペインに表示される監視テレメトリを確認します。

   >**注**:監視ペインには、アプリケーション サーバー、データベース サーバー、SAP セントラル サービス インスタンスの vCPU 使用率のグラフとメトリックが含まれています。 また、データベース ディスク IOPS 統計データベース サーバーも含まれます。 

1. **[VI1]** ページの左側にある縦型ナビゲーション メニューの **[監視]** セクションで、**[Quality insights]\(品質の分析情報\)** を選択します。
1. **[VI1 \| Quality insights (品質の分析情報) \| ブック 1]** ページで、**[アドバイザーの推奨事項]** タブを確認 します。これは、Virtual Instance for SAP solutions (VIS)、セントラル サーバー インスタンス、App Service インスタンス、データベースの最適化に関する推奨事項を提供することを目的としています。

   >**注**:これらの推奨事項では、SAP ソフトウェアのインストールを完了することが求められます。

1. **[VI1 \| Quality insights (品質の分析情報) \| ブック 1]** ページで、**[仮想マシン]** タブを選択し、**[Azure Compute]**、**[コンピューティングの一覧]**、**[コンピューティング拡張機能]**、**[コンピューティングと OS ディスク]**、**[コンピューティングとデータ ディスク]** の各タブの内容を確認します。

   >**注**:これらの各タブには、Virtual Instance for SAP solutions の一部である Azure VM から収集された実際のデータが含まれています。

1. **[VI1 \| Quality insights (品質の分析情報) \| ブック 1]** ページで、**[構成チェック]** タブを選択し、**[高速ネットワーク]**、**[パブリック IP]**、**[バックアップ]**、**[ロード バランサー]** の各タブの内容を確認します。 この内容は、Virtual Instance for SAP solutions のコンピューティングとネットワークのコンポーネントについて、パフォーマンスとセキュリティに関連した設定の概要を簡単に示しています。 **[ロード バランサー]** タブには、ロード バランサーの主要なメトリックを表示する **[ロード バランサーのモニター]** の情報が含まれています。
1. **[VI1]** ページの左側にある縦型ナビゲーション メニューの **[監視]** セクションで、**[Azure Monitor for SAP solutions]** を選択します。
1. **[VI1 \| Azure Monitor for SAP solutions]** ページで、VIS の SAP ソフトウェアのインストールまたは登録が完了していないために AMS をセットアップできないことを示すメッセージに注意してください。

   >**注**:SAP ソフトウェアは、インストールすると、新規または既存の Azure Monitor for SAP solutions リソースと統合できるようになります。 Azure Monitor for SAP solutions は、Log Analytics とブックの Azure Monitor 機能を使用して、カスタムの視覚化、クエリ、アラートのサポートなど、Azure VM でホストされている SAP ワークロードの包括的な監視を提供します。
